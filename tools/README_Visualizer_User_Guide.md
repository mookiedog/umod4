# Visualizer User Guide

The visualizer is a program that displays logs generated by UM4 ECU firmware running on umod4 PCB installed in an Aprilia Gen 1 ECU.
The log contains data relating to engine operation that gets correlated with GPS position and velocity data in real time.
The visualizer allows a user to analyze engine operation down to 1/6 of a rotation of the crankshaft for an entire ride.
GPS data is captured 10 times per second while the bike is moving.
The visualizer provides a means of displaying all this information.

## Opening A Logfile

There are two forms of logfiles.
The logfiles created on the motorbike are stored in a highly space-efficient fashion and will have a .um4 suffix, like "log_123.um4".
The visualizer needs to convert the .um4 log files into the [HDF5](https://en.wikipedia.org/wiki/Hierarchical_Data_Format) file format.
The converted files have a ".h5" suffix, such as "log_123.h5".

The HDF5 data format is what what the graphing portion of the visualizer needs for high performance when displaying logs.

Conversion from .um4 to .h5 is essentially automatic.
Using the file/open menu to open a .um4 file will cause a window to open offering to convert the .um4 file to .h5 format.
This needs to be done only once.
Thereafter, the .h5 file can be opened directly.
By default, the .h5 version of the file will be stored in the same directory as the original logfile, with the same name as the original log file but with a .h5 suffix.

## Windows

The visualizer window is broken into three sub-windows.

* Stream Selector window: Enabling or disabling a stream's checkbox causes the stream to appear in or disappear from the detail window.
* Navigation window: The narrow strip across the bottom.
This window shows the entire log as a low-fidelity display.
The highlighted blue box in the nav window corresponds to the data shown in the detail window.
* Detail window: The main window showing detail of the data in the blue selection box in the nav window.

The sizes of the sub windows can be adjusted by clicking and dragging the borders between them.

## Enabling Data Streams For Graphing

Click a checkbox beside a graphical data stream name to enable seeing that stream in the navigation and detail windows.
The system always defaults to showing "instantaneous RPM", which is the engine speed measured every 1/6 of a crankshaft rotation.

The colors for the streams being selected can be changed by right clicking the checkbox.
That will bring up a color picker to choose a different color.

_Note: All configuration mechanisms in the visualizer are designed to persist across invocations of the program._

### Axis Ownership

The detail window only has room for two vertical axis.
The primary axis is on the left and the secondary axis is on the right.

Enabling a data stream will automatically assign ownership of the primary axis to that new data stream.
Axis ownership means that the graph scaling units, line spacing and name of the axis are set according to that of its new owner.
An Coolant Temperature data stream would label the axis as Coolant (C), and the axis numbering would change to make sense for temperature measurements, such as ranging from maybe 0C to 120C.

When selecting a new data stream, any data stream that had preiously been using the primary axis will get shifted to use the secondary axis.
Any stream can be assigned ownership of the primary axis by clicking on its name in the stream selector window.

### Marker Streams

Many of the available data streams can be graphed in the detail window.
Things like coolant temperation, RPM, GPS velocity all lend themselves to being graphed directly on the detail screen.
However, some data streams are not graphical in the traditional sense because they really only make sense in the context of other data.

Examples would be the SPARK streams which indicate when a spark was detected on a coil, or the CRID which indicates what portion of the 4-stroke engine operation the crankshaft is currently performing.
Both the SPARK and CRID streams make sense when correlated with instantaneous RPM.
Enabling either of those data streams will annotate the instantaneous RPM graph line with information.
The spark markers indicate precisely where a spark was detected in relation to crankshaft position.
The CRID markers indicates the start of every CR subrotation of the crankshaft.

Note that the engine produces vast amounts of data.
Enabling markers at any zoom level could cause literally hundreds of thousands of them to be drawn on the screen.
As a result, markers only get draw when the zoom level is sufficient so that the graph is not overwhelmed with marker data.
If you can't see markers, zoom in some more.

Marker streams do not trigger changes of axis ownership.

---

## For Developers: Build Diagnostics

If you're building the visualizer with PyInstaller and encountering issues (especially with Windows builds), comprehensive diagnostic tools are available.

### Quick Diagnostic Check

```bash
# Run local diagnostic before pushing to GitHub
./tools/diagnose_pyinstaller.sh

# Analyze an existing executable
./tools/analyze_existing_build.sh path/to/DataVisualizer.exe
```

### Documentation

* [QUICK_REFERENCE.md](QUICK_REFERENCE.md) - Quick command reference
* [DIAGNOSTIC_TOOLS_SUMMARY.md](DIAGNOSTIC_TOOLS_SUMMARY.md) - Complete system overview
* [PYINSTALLER_DIAGNOSTICS.md](PYINSTALLER_DIAGNOSTICS.md) - Detailed debugging guide

### What These Tools Do

The diagnostic system automatically:

1. Extracts and inspects PyInstaller executables
2. Tests module availability at runtime
3. Analyzes build logs for warnings and errors
4. Compares builds across Windows/Linux/macOS
5. Generates comprehensive reports showing exactly what's wrong

This eliminates the guess-and-check cycle when modules are missing from packaged executables.
