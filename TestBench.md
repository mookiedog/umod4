# Test Bench Enhancements

## Biggest Issue

The biggest issue is getting CAM and CRANK signals into the ECU.
All of the other stuff like mechanical and electrical for coils and sparkplugs is relatively easy.

## Idea

It might be interesting to build a device that simulates a running engine.

It would have a starter button that would simulate slow changing crank and cam signals that would speed up when sparks were observed.

There are two basic ways to do it:

1) make some rotating iron toothwheels and use real VR sensors
1) simulate VR sensor outputs using some other embedded system

After looking into VR sensors, I am coming to the conclusing that building some rotating machinery to stimulate some real VR sensors would be difficult.
It would involve sourcing motors, constructing motor control, building mechanical mounts, machinine code wheels, and probably other stuff too.
It's a lot of work in a lot of areas.

On the other hand, I'm not sure what it would take to simulate a VR sensor output.
Decoding the existing VR processing circuitry is hard.
I am not making much process on the topic, and am not sure that I would be able to do it anyway even with more effort.

## Simulating via Fake VR events

I can certainly generate positive and negative voltage pulses that change width with frequency.

The fastest signals would be the crank signal.
At 11,000 RPM, there would be 183 revolutions per second, or 1100 crankshaft events per second.

## Simulate a Rotating Engine

I would need to generate signals that are recognized as proper CAM and CRANK events.
These are analog signals, generated by magnetic sensors.

The CRANK circuitry grounds the negative sensor input, and appears to measure voltage on the positive sensor input.
The default situation assumes that we have seen a negative transition and are waiting for the voltage to go positive by about 1V.
Seeing at least +1V on the positive input drives the CRANK output low.
The output remains low until we see a zero cross into the negative regime, followed by the +input dropping below about -1V.

There is a 3K resistance between the ECU's crank signals N+ and N-.

There is a 23K resistance between the ECU's cam signals G+ and G-.

## VR Test Sensors

The Aprilia crank sensor is a positive edge first sensor.
It is spec'd as 240 Ohm.

### Hyundai

The Hyundai crank/cam sensor 391802B000 I got from eBay is a positive edge first sensor.
It measures out at 890 Ohm.

They generated good signal into a 2K and a 20K load resistor.
With a 20K resistor, the positive edges were approximately +20V peak, and the negative edges were approximately -40V peak.

### Chevy

The pair of used VR sensors off my old Chevy antilock brake system are negative edge first.

## Coils

The stock coils are Denso 129700.
This appears to be a generic part number.
Googleing this part number shows that there are a lot of related parts 129700-xxxx where xxxx may define a different physical size and/or number of turns in the secondary coil.

I measure the coil primaries at approx 4.1 Ohm. Measured current with a nominal 12V supply is 3.0A, which agrees with Ohm's Law.
The coils are marked with + and - symbols on the end of the coil where the spade lugs come out.

Wiring:

* coil "+" terminal: +12 supply (can be switched to simulate an ignition switch)
* coil '-' terminal:
  * supply GND
  * sparkplug body GND

The ECU will ground the '-' terminal to charge the coil and let it float again to fire the coil.
